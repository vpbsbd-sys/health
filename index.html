<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Health is Wealth App</title>
    <style>
        :root {
            --primary-green: #27ae60;
            --primary-blue: #2980b9;
            --accent-orange: #f39c12;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            color: var(--text-main);
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 480px; margin-bottom: 50px; }
        .logo-container { text-align: center; padding: 10px 0; }
        .logo-container img { width: 180px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border-top: 5px solid var(--primary-green);
        }

        label {
            display: block; font-weight: 700; font-size: 11px;
            margin-bottom: 5px; color: var(--primary-blue); text-transform: uppercase;
        }

        .input-row { display: flex; gap: 8px; margin-bottom: 12px; }
        input, select, textarea {
            width: 100%; padding: 12px; border: 2px solid #edf2f7;
            border-radius: 12px; font-size: 15px; background: #f8fafc; box-sizing: border-box;
        }

        .mic-btn {
            background: #f8fafc; border: 2px solid #edf2f7; border-radius: 12px;
            cursor: pointer; padding: 0 12px; font-size: 18px; min-width: 50px;
        }

        .mic-btn.listening { background: #e74c3c; color: white; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        button {
            border: none; padding: 15px; border-radius: 12px;
            font-size: 14px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }

        .save-btn { background: var(--primary-green); color: white; box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3); }
        .fetch-btn { background: var(--primary-blue); color: white; box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3); }

        .visit-card {
            background: white; border-radius: 15px; padding: 15px;
            margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 6px solid var(--accent-orange);
        }

        .visit-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .tag { font-size: 10px; background: #ebf8ff; color: #2b6cb0; padding: 3px 8px; border-radius: 5px; text-transform: uppercase; }
        #syncStatus { text-align: center; font-size: 12px; margin-top: 10px; color: var(--primary-green); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="logo-container">
        <img src="image_589dda.png" alt="Health is Wealth Logo">
    </div>

    <div class="card">
        <label>Visit Date</label>
        <input type="date" id="visitDate" style="margin-bottom:12px;">

        <label>Patient Name</label>
        <div class="input-row">
            <input type="text" id="userName" placeholder="Your Full Name">
            <button class="mic-btn" onclick="runSpeech('userName')">üé§</button>
        </div>

        <label>Doctor's Name</label>
        <div class="input-row">
            <input type="text" id="drName" placeholder="Attending Doctor">
            <button class="mic-btn" onclick="runSpeech('drName')">üé§</button>
        </div>

        <label>Category</label>
        <select id="categorySelect" onchange="updateIllnessDropdown()" style="margin-bottom:12px;"></select>

        <label>Problem / Illness</label>
        <select id="illnessSelect" style="margin-bottom:12px;"></select>

        <label>Medication Given</label>
        <div class="input-row">
            <input type="text" id="medicine" placeholder="e.g. Paracetamol 500mg">
            <button class="mic-btn" onclick="runSpeech('medicine')">üé§</button>
        </div>

        <label>Notes</label>
        <div class="input-row">
            <textarea id="notes" rows="2" placeholder="Advice..."></textarea>
            <button class="mic-btn" onclick="runSpeech('notes')">üé§</button>
        </div>

        <div class="action-btns">
            <button class="save-btn" onclick="addVisit()">Save ‚òÅÔ∏è</button>
            <button class="fetch-btn" onclick="fetchHistory()">Fetch All üîÑ</button>
        </div>
        <div id="syncStatus"></div>
    </div>

    <h3 style="padding-left:10px;">History</h3>
    <div id="visitHistory"></div>
</div>

<script>
    const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbwNVWdOXMbrPLB6tQ_TKPTkCfcuM8_KJ2AEEiDIMPDst52NnR8Vfa2Xl0l1YVrqCWjiZQ/exec";

    const medicalData = {
        "General / Infection": ["Fever", "Viral Fever", "Bacterial Infection", "Cold", "Cough", "Cold & Cough", "Sore Throat", "Flu (Influenza)", "COVID-like symptoms", "Body Ache", "Fatigue / Weakness"],
        "Pain & Injury": ["Headache", "Migraine", "Back Pain", "Neck Pain", "Shoulder Pain", "Knee Pain", "Joint Pain", "Muscle Pain", "Injury / Trauma", "Sprain / Strain"],
        "Heart / BP": ["High Blood Pressure (Hypertension)", "Low Blood Pressure", "Chest Pain", "Palpitations", "Heart Check-up (Routine)"],
        "Digestive System": ["Stomach Pain", "Acidity / GERD", "Indigestion", "Gas / Bloating", "Diarrhea", "Constipation", "Vomiting", "Food Poisoning", "Liver Problem"],
        "Diabetes / Metabolic": ["Diabetes ‚Äì Routine Check", "High Sugar Level", "Low Sugar Level", "Thyroid Disorder", "Cholesterol Problem", "Obesity / Weight Issue"],
        "Respiratory": ["Asthma", "Breathing Difficulty", "Bronchitis", "Pneumonia"],
        "Neurological": ["Anxiety", "Stress", "Depression", "Sleep Disorder (Insomnia)", "Dizziness", "Vertigo", "Memory Issues"],
        "Bone / Ortho": ["Arthritis", "Osteoporosis", "Fracture", "Slip Disc", "Sciatica", "Bone Pain"],
        "Skin / Hair": ["Skin Allergy", "Rashes", "Itching", "Fungal Infection", "Acne", "Hair Fall", "Dandruff", "Psoriasis", "Eczema"],
        "Eye / ENT": ["Eye Infection", "Eye Pain", "Vision Problem", "Ear Pain", "Ear Infection", "Hearing Issue", "Sinusitis", "Tonsillitis"],
        "Urinary / Kidney": ["Urinary Tract Infection (UTI)", "Burning Urination", "Kidney Stone", "Frequent Urination", "Prostate Issue"],
        "Men / Women": ["Menstrual Pain", "Irregular Periods", "PCOD / PCOS", "Pregnancy Check-up", "Menopause Issues", "Erectile Dysfunction", "Hormonal Issue"],
        "Routine": ["General Check-up", "Blood Test Review", "X-ray / Scan Review", "Vaccination", "Medical Certificate", "Fitness Check"]
    };

    window.onload = () => {
        // Set default date to today
        document.getElementById('visitDate').valueAsDate = new Date();
        
        const catSelect = document.getElementById('categorySelect');
        catSelect.add(new Option("-- Select Category --", ""));
        Object.keys(medicalData).forEach(cat => catSelect.add(new Option(cat, cat)));
        
        document.getElementById('userName').value = localStorage.getItem('patientName') || "";
        document.getElementById('drName').value = localStorage.getItem('doctorName') || "";
        renderHistory(JSON.parse(localStorage.getItem('myVisits')) || []);
    };

    function updateIllnessDropdown() {
        const cat = document.getElementById('categorySelect').value;
        const illSelect = document.getElementById('illnessSelect');
        illSelect.innerHTML = '<option value="">-- Select Illness --</option>';
        if (cat) medicalData[cat].forEach(ill => illSelect.add(new Option(ill, ill)));
    }

    function runSpeech(fieldId) {
        const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!SpeechRecognition) return alert("Browser not supported.");
        const recognition = new SpeechRecognition();
        const btn = event.currentTarget;
        recognition.onstart = () => btn.classList.add('listening');
        recognition.onend = () => btn.classList.remove('listening');
        recognition.onresult = (e) => { document.getElementById(fieldId).value = e.results[0][0].transcript; };
        recognition.start();
    }

    async function addVisit() {
        const vDate = document.getElementById('visitDate').value;
        const name = document.getElementById('userName').value;
        const dr = document.getElementById('drName').value;
        const cat = document.getElementById('categorySelect').value;
        const ill = document.getElementById('illnessSelect').value;
        const med = document.getElementById('medicine').value;
        const note = document.getElementById('notes').value;

        if (!ill || !med || !name) return alert("Please fill Name, Illness and Medicine.");

        localStorage.setItem('patientName', name);
        localStorage.setItem('doctorName', dr);

        const visit = { date: vDate, name, doctor: dr, category: cat, illness: ill, medicine: med, notes: note };

        // Save Local
        let visits = JSON.parse(localStorage.getItem('myVisits')) || [];
        visits.push(visit);
        localStorage.setItem('myVisits', JSON.stringify(visits));

        // Save Cloud
        document.getElementById('syncStatus').innerText = "Syncing...";
        try {
            await fetch(GOOGLE_SHEET_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(visit) });
            document.getElementById('syncStatus').innerText = "‚úì Saved Successfully";
        } catch (e) {
            document.getElementById('syncStatus').innerText = "Saved Locally Only";
        }
        renderHistory(visits);
    }

    async function fetchHistory() {
        document.getElementById('syncStatus').innerText = "Fetching from Cloud...";
        try {
            const response = await fetch(GOOGLE_SHEET_URL);
            const cloudData = await response.json();
            localStorage.setItem('myVisits', JSON.stringify(cloudData));
            renderHistory(cloudData);
            document.getElementById('syncStatus').innerText = "‚úì History Updated";
        } catch (e) {
            alert("Error fetching data. Ensure Web App is deployed as 'Anyone'.");
        }
    }

    function renderHistory(data) {
        const historyDiv = document.getElementById('visitHistory');
        historyDiv.innerHTML = '';
        data.slice().reverse().forEach(v => {
            historyDiv.innerHTML += `
                <div class="visit-card">
                    <div class="visit-header">
                        <span style="font-size:11px; font-weight:bold;">${v.date}</span>
                        <span class="tag">${v.category}</span>
                    </div>
                    <h4 style="margin:5px 0;">${v.illness}</h4>
                    <p style="margin:0; font-size:13px;"><strong>Dr:</strong> ${v.doctor}</p>
                    <p style="margin:5px 0 0 0; font-size:14px;"><strong>Meds:</strong> ${v.medicine}</p>
                    <p style="margin:5px 0 0 0; font-size:12px; color:#718096;"><em>${v.notes}</em></p>
                </div>`;
        });
    }
</script>
</body>
</html>


